function wipImageZoomDirective(e){return{restrict:"EA",template:'<div class="wip-image-zoom {{vm.options.style}}-style {{vm.options.thumbsPos}}-thumbs"\n     ng-class="{\n     \'active\':vm.zoomActive, \n     \'immersive-mode\':vm.immersiveModeActive && !immersive,\n     \'box-style\':vm.options.style == \'box\' ,\n     \'inner-style\':vm.options.style == \'inner\'}">\n\n    <wip-image-zoom-thumbs ng-if="vm.options.thumbsPos === \'top\' && vm.images.length > 1"></wip-image-zoom-thumbs>\n\n    <div class="main-image-wrapper">\n        <div class="image-zoom-tracker" wip-image-zoom-tracker></div>\n        <div class="image-zoom-lens" wip-image-zoom-lens></div>\n        <img class="main-image" ng-src="{{vm.mainImage.medium}}">\n        <div class="zoom-mask"\n             ng-class="vm.options.style == \'box\' ? vm.options.boxPos:\'\'"\n             wip-image-zoom-mask>\n            <img wip-image-zoom-image class="zoom-image main-image-large"\n                 ng-src="{{vm.mainImage.large}}" image-on-load="vm.initZoom()">\n        </div>\n        <div ng-if="vm.immersiveModeActive && !immersive && vm.options.immersiveModeMessage !== \'\'"\n             class="immersive-mode-message" ng-bind="vm.options.immersiveModeMessage"></div>\n    </div>\n\n    <wip-image-zoom-thumbs\n            ng-if="vm.options.thumbsPos === \'bottom\' && vm.images.length > 1"></wip-image-zoom-thumbs>\n</div>',replace:!0,scope:{selectedModel:"=?",selectedIndex:"=?",wipImageZoom:"=",immersive:"=?"},controllerAs:"vm",link:function(e,o,i,m){m.el=o,m.init()},controller:["$scope","$document","$window","$compile",function(o,i,m,t){function n(){H.options=o.wipImageZoom?angular.extend(N,o.wipImageZoom):N,H.images=H.options.images,H.mainImage=H.images[H.options.defaultIndex],o.selectedIndex=H.options.defaultIndex,o.selectedModel=H.mainImage}function s(){j&&e.cancel(j),j=e(function(){u(),a(),x()},400)}function a(){h(),H.zoomTracker.style.cursor=H.options.cursor,H.options.lens?H.zoomLens.style.display="block":H.zoomLens.style.display="none",l(),H.immersiveModeActive=H.options.immersiveMode&&H.options.immersiveMode>m.innerWidth,H.immersiveModeActive&&!o.immersive&&H.zoomTracker.addEventListener("mousedown",d),(!H.immersiveModeActive||o.immersive)&&r()}function r(){H.zoomTracker.addEventListener("mousemove",k),H.zoomTracker.addEventListener("touchstart",k),H.zoomTracker.addEventListener("mouseleave",y),H.zoomTracker.addEventListener("touchend",y),H.zoomTracker.addEventListener("mousemove",b),H.zoomTracker.addEventListener("touchmove",b)}function l(){H.zoomTracker.removeEventListener("mousedown",d),H.zoomTracker.removeEventListener("mousemove",k),H.zoomTracker.removeEventListener("touchstart",k),H.zoomTracker.removeEventListener("mouseleave",y),H.zoomTracker.removeEventListener("touchend",y),H.zoomTracker.removeEventListener("mousemove",b),H.zoomTracker.removeEventListener("touchmove",b)}function c(){i.find("html").removeClass("wip-image-zoom-immersive-mode-enabled"),l(),H.immersedEl.remove(),s()}function d(e){e.preventDefault(),e.stopPropagation(),o.$apply(function(){i.find("html").addClass("wip-image-zoom-immersive-mode-enabled");var e=i.find("body").eq(0);H.immersedImageOpt=angular.copy(H.options),H.immersedImageOpt.style="inner",H.immersedImageOpt.defaultIndex=o.selectedIndex,H.immersedEl=t('<div class="immersive-wip-image-zoom">\n    <div class="disable-immersive-mode-button" ng-click="vm.disableImmersiveMode()">\n        &#10006;</div>\n    <img src="" wip-image-zoom="vm.immersedImageOpt" immersive="true" selected-index="selectedIndex">\n</div>\n')(o),e.append(H.immersedEl),s()})}function u(){H.images.length<=1||(H.thumbsWrapperWidth=H.thumbsWrapper.clientWidth,H.thumbWidth=Math.round((H.thumbsWrapperWidth+H.options.thumbColPadding)/H.options.thumbCol),H.thumbsWidth=H.thumbWidth*H.images.length,H.maxPosX=H.images.length-H.options.thumbCol,o.$evalAsync(function(){"top"==H.options.thumbsPos?(H.thumbsEl.style.paddingBottom=H.options.thumbColPadding+"px",H.thumbsEl.style.paddingTop=0):(H.thumbsEl.style.paddingTop=H.options.thumbColPadding+"px",H.thumbsEl.style.paddingBottom=0);for(var e=0;e<H.thumbsEl.children.length;e++){var o=H.thumbsEl.children[e];o.style.width=H.thumbWidth+"px",o.style.paddingRight=H.options.thumbColPadding+"px"}}))}function g(){p(H.thumbsPos+1)}function v(){p(H.thumbsPos-1)}function p(e){e=0>e?0:e,e=e>H.maxPosX?H.maxPosX:e,H.thumbsPos=e;var o=H.thumbsPos*H.thumbWidth*-1;H.thumbsEl.style.transform="translate3d("+o+"px, 0px, 0)"}function h(){var e=H.zoomTracker.getBoundingClientRect();Z=e.width,P=e.height,A=e.left+m.scrollX,D=e.top+m.scrollY,"box"!=H.options.style||o.immersive?(W=Z,C=P,H.zoomMaskEl.style.width="100%",H.zoomMaskEl.style.height="100%"):(W=H.options.boxW,C=H.options.boxH,H.zoomMaskEl.style.width=W+"px",H.zoomMaskEl.style.height=C+"px"),H.options.zoomLevel>1&&(H.zoomImageEl.style.width=Z*H.options.zoomLevel+"px",H.zoomImageEl.style.height=P*H.options.zoomLevel+"px"),$=H.zoomImageEl.offsetWidth,B=H.zoomImageEl.offsetHeight,z()}function b(e){e.preventDefault();var o="touchmove"==e.type&&e.touches&&e.touches[0];L=o&&o.pageX||e.pageX,M=o&&o.pageY||e.pageY,w(),"lens"===H.options.method?f():I()}function f(){var e=[($-W+1*O/Y)*[q/Z]],o=[(B-C+1*X/Y)*[R/P]];H.zoomImageEl.style.transform="translate3d("+-1*e+"px,"+-1*o+"px,0)"}function I(){var e=[($-W)*[(L-A)/Z]],o=[(B-C)*[(M-D)/P]];e=A>L?0:e,o=D>M?0:o,e=L>A+Z?$-W:e,o=M>D+P?B-C:o,H.zoomImageEl.style.transform="translate3d("+-1*e+"px,"+-1*o+"px,0)"}function z(){Y=Z/$,O=W*Y,X=C*Y,H.zoomLens.style.width=O+"px",H.zoomLens.style.height=X+"px"}function w(){q=L-A-.5*O,R=M-D-.5*X,q=q>Z-O?Z-O:q,q=0>q?0:q,R=R>P-X?P-X:R,R=0>R?0:R,H.zoomLens.style.transform="translate3d("+q+"px,"+R+"px,0)"}function x(){if(!(H.images.length<=1)){var e=E(),o=H.thumbsPos+H.options.thumbCol>e&&H.thumbsPos<e;return o?void p(H.thumbsPos):void p(e)}}function E(){for(var e=0;e<H.images.length;e++)if(H.images[e].medium===H.mainImage.medium)return e}function k(){o.$evalAsync(function(){H.zoomActive=!0})}function y(){o.$evalAsync(function(){H.zoomActive=!1})}function T(e){H.mainImage=e,o.selectedModel=H.mainImage,o.selectedIndex=H.images.indexOf(H.mainImage)}var L,M,Z,P,A,D,W,C,$,B,O,X,q,R,Y,H=this,N={defaultIndex:0,images:[],style:"inner",boxPos:"right-top",boxW:400,boxH:400,method:"lens",cursor:"crosshair",lens:!0,zoomLevel:3,immersiveMode:769,immersiveModeMessage:"Click to Zoom",prevThumbButton:"&#9665;",nextThumbButton:"&#9655;",thumbsPos:"bottom",thumbCol:3,thumbColPadding:4},j=!0;H.el,H.zoomTracker,H.zoomLens,H.zoomImageEl,H.thumbsWrapper,H.thumbsEl,H.mainImage,H.options,H.images=[],H.zoomActive=!1,H.prevThumbActive=!1,H.nextThumbActive=!1,H.thumbWidth,H.thumbsWrapperWidth,H.thumbsWidth,H.thumbsPos=0,H.immersiveModeActive,H.init=n,H.initZoom=a,H.initThumbs=u,H.updateMainImage=T,H.nextThumb=g,H.prevThumb=v,H.disableImmersiveMode=c,o.$watch("selectedModel",function(e,o){angular.isDefined(e)&&e!==o&&(H.mainImage=e,x())},!0),o.$watch("selectedIndex",function(e,o){angular.isDefined(e)&&e!==o&&(H.mainImage=H.images[e],x())},!0),angular.element(window).on("resize",function(){s()}),m.Ps&&angular.element(document).on("ps-scroll-y",function(){h()}),o.$watch(function(){return{left:H.zoomTracker.getBoundingClientRect().left+m.scrollX,top:H.zoomTracker.getBoundingClientRect().top+m.scrollY}},function(e,o){angular.isDefined(e)&&e!==o&&s()},!0),o.$watch("wipImageZoom",function(e,o){angular.isDefined(e)&&e!==o&&(n(),s())},!0)}]}}function wipImageZoomLensDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,m){m.zoomLens=o[0]}}}function wipImageZoomTrackerDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,m){m.zoomTracker=o[0]}}}function wipImageZoomMaskDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,m){m.zoomMaskEl=o[0]}}}function wipImageZoomImageDirective(){return{restrict:"EA",require:"^wipImageZoom",link:function(e,o,i,m){m.zoomImageEl=o[0]}}}function wipImageZoomThumbsDirective(){return{restrict:"EA",require:"^wipImageZoom",template:'<div class="thumbs-wrapper" ng-swipe-left="vm.nextThumb()" ng-swipe-right="vm.prevThumb()">\n    <div class="thumbs" >\n        <div class="thumb-wrapper" ng-repeat="image in vm.images">\n            <img ng-src="{{image.thumb}}" ng-click="vm.updateMainImage(image)"\n                 ng-class="{\'selected\': vm.mainImage.thumb === image.thumb}">\n        </div>\n    </div>\n</div>\n<div class="prev-button"\n     ng-if="vm.thumbsPos !== 0"\n     ng-click="vm.prevThumb()"\n     ng-bind-html="vm.options.prevThumbButton">Prev\n</div>\n<div class="next-button"\n     ng-if="vm.thumbsPos !== vm.maxPosX"\n     ng-click="vm.nextThumb()"\n     ng-bind-html="vm.options.nextThumbButton">Next\n</div>',link:function(e,o,i,m){m.thumbsWrapper=o[0].getElementsByClassName("thumbs-wrapper")[0],m.thumbsEl=o[0].getElementsByClassName("thumbs")[0],m.initThumbs()}}}function imageOnLoadDirective(e){return{restrict:"A",link:function(o,i,m){i[0].addEventListener("load",function(){o.$apply(m.imageOnLoad)},!1),i[0].addEventListener("error",function(){e.warn("image could not be loaded")})}}}imageOnLoadDirective.$inject=["$log"],wipImageZoomDirective.$inject=["$timeout"],angular.module("wipImageZoom",["ngSanitize","ngTouch"]).directive("imageOnLoad",imageOnLoadDirective).directive("wipImageZoom",wipImageZoomDirective).directive("wipImageZoomTracker",wipImageZoomTrackerDirective).directive("wipImageZoomLens",wipImageZoomLensDirective).directive("wipImageZoomMask",wipImageZoomMaskDirective).directive("wipImageZoomImage",wipImageZoomImageDirective).directive("wipImageZoomThumbs",wipImageZoomThumbsDirective);